# Last Words - Complete File Tree

```
last-words/
├── .eslintrc.js                           # ESLint configuration
├── .gitignore                             # Git ignore patterns
├── .nvmrc                                 # Node version (v20)
├── .prettierrc.json                       # Prettier configuration
├── package.json                           # Root package.json with workspaces
├── README.md                              # Project documentation
│
├── backend/                               # Backend Lambda functions + game engine
│   ├── package.json                       # Backend dependencies
│   ├── tsconfig.json                      # TypeScript config
│   ├── vitest.config.ts                   # Vitest test config
│   ├── esbuild.mjs                        # Build script for handlers
│   │
│   ├── src/
│   │   ├── game/
│   │   │   ├── engine/
│   │   │   │   ├── types.ts              # Core game types (ModuleSpec, frames)
│   │   │   │   └── registry.ts           # Module registry
│   │   │   └── modules/
│   │   │       └── glyphOrder.ts         # Glyph Order puzzle module
│   │   │
│   │   ├── handlers/
│   │   │   ├── ws/
│   │   │   │   ├── connect.ts            # WebSocket $connect handler
│   │   │   │   ├── disconnect.ts         # WebSocket $disconnect handler
│   │   │   │   └── default.ts            # WebSocket $default handler (main)
│   │   │   └── http/
│   │   │       ├── createLobby.ts        # POST /lobbies
│   │   │       ├── joinLobby.ts          # POST /lobbies/{id}/join
│   │   │       ├── startMatch.ts         # POST /matches/start
│   │   │       └── chimeAttendee.ts      # POST /matches/{id}/chime/attendee
│   │   │
│   │   └── lib/
│   │       ├── ddb.ts                    # DynamoDB utilities
│   │       ├── ws.ts                     # WebSocket broadcast utilities
│   │       ├── chime.ts                  # Amazon Chime SDK utilities
│   │       └── util.ts                   # General utilities (ID generation, etc)
│   │
│   ├── test/
│   │   └── glyphOrder.test.ts            # Unit tests for glyphOrder module
│   │
│   └── dist/                              # Build output (generated by esbuild)
│       ├── ws/
│       │   ├── connect.mjs
│       │   ├── disconnect.mjs
│       │   └── default.mjs
│       └── http/
│           ├── createLobby.mjs
│           ├── joinLobby.mjs
│           ├── startMatch.mjs
│           └── chimeAttendee.mjs
│
├── web/                                   # React frontend
│   ├── package.json                       # Frontend dependencies
│   ├── tsconfig.json                      # TypeScript config
│   ├── tsconfig.node.json                 # TypeScript config for Vite
│   ├── vite.config.ts                     # Vite configuration
│   ├── index.html                         # HTML entry point
│   │
│   ├── public/
│   │   └── config.js                      # Runtime config (WS_URL, HTTP_URL)
│   │
│   └── src/
│       ├── main.tsx                       # Application entry point
│       ├── App.tsx                        # Root component with routing
│       ├── index.css                      # Global styles
│       ├── config.ts                      # Config reader
│       │
│       ├── pages/
│       │   ├── Home.tsx                   # Home page (create lobby)
│       │   ├── Lobby.tsx                  # Lobby page
│       │   ├── Match.tsx                  # Match page (gameplay)
│       │   └── Spectate.tsx               # Spectator view
│       │
│       ├── modules/
│       │   └── glyphOrder/
│       │       └── GlyphOrderView.tsx     # Glyph Order UI component
│       │
│       ├── state/
│       │   └── useSession.ts              # Zustand session store
│       │
│       ├── net/
│       │   └── wsClient.ts                # WebSocket client
│       │
│       └── voice/
│           └── chimeClient.ts             # Amazon Chime SDK client
│
└── infra/                                 # AWS CDK infrastructure
    ├── package.json                       # CDK dependencies
    ├── tsconfig.json                      # TypeScript config
    ├── cdk.json                           # CDK configuration
    │
    ├── bin/
    │   └── last-words.ts                  # CDK app entry point
    │
    └── lib/
        ├── data-stack.ts                  # DynamoDB table + GSIs
        ├── api-stack.ts                   # API Gateway (WS + HTTP) + Lambdas
        └── web-stack.ts                   # S3 + CloudFront distribution
```

## Key Files and Their Purpose

### Root Level
- **package.json**: Monorepo configuration with pnpm workspaces
- **README.md**: Project documentation and quickstart guide

### Backend (`backend/`)
- **esbuild.mjs**: Bundles all handler files for Lambda deployment
- **src/game/**: Game engine with modular puzzle system
- **src/handlers/**: Lambda handlers for WebSocket and HTTP APIs
- **src/lib/**: Shared utilities for DDB, WebSocket, and Chime

### Web (`web/`)
- **src/pages/**: React pages for different game states
- **src/modules/**: Puzzle module UI components
- **src/net/wsClient.ts**: WebSocket client for realtime communication
- **src/voice/chimeClient.ts**: Chime SDK integration for voice chat
- **public/config.js**: Runtime configuration (replaced after CDK deploy)

### Infrastructure (`infra/`)
- **bin/last-words.ts**: CDK app that orchestrates all stacks
- **lib/data-stack.ts**: DynamoDB single-table with GSIs
- **lib/api-stack.ts**: WebSocket API + HTTP API + Lambda integrations
- **lib/web-stack.ts**: S3 bucket + CloudFront CDN for frontend

## DynamoDB Schema

**Table Name**: `LastWords`

**Primary Key**: `pk` (partition key), `sk` (sort key)

**GSI1**: `gsi1pk` + `gsi1sk` (for querying active matches)
**GSI2**: `gsi2pk` + `gsi2sk` (for querying connections by match)

**Item Types**:
- `USER#<id>` - User profile
- `LOBBY#<lobbyId>` - Lobby state
- `MATCH#<matchId>` - Match state (includes moduleStates, moduleParams)
- `CONN#<connectionId>` - WebSocket connection info
- `SNAP#<matchId>#<ts>` - Match snapshot for replay

**TTL Attribute**: `ttl` (for automatic cleanup)
